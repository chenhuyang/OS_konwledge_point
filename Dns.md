# About DNS
## 一、什么是DNS
* DNS全称为Domain Name System，即域名系统，其作用就是将我们经常使用的“网址”解析为IP地址。
* 在互联网上通信需要借助于IP地址，但人类对于数字的记忆能力远不如文字，那么将IP地址转换成容易记忆的文字是个好办法，可是计算机只能识别0、1代码，这时就需要一种机制来解决IP地址与主机名的转换问题。
* 早期由于网络上的主机数量有限，主机名和IP的解析借助于hosts文件即可完成，Linux中此文件一般存放路径为/etc/hosts，在此文件中手动记录每个主机名与其IP的对应关系；但hosts文件的内容不能自动更新，一旦主机名或IP地址发生变化，需要手动对每一台主机进行更新。
* 随着互联网的发展，网络上可供人们访问的网站越来越多，hosts文件已经不能满足需求；为了解决此问题，伯克利大学研究出了一套系统，被称为BIND(Berkeley Internet Name Domain),也就是现在流行的DNS。
* DNS利用树形目录结构，将主机名的管理分配给不同的层级，这样可以实现更加快速的完成主机名的查找，修改主机名解析时也更加方便。
## 二、相关概念
### 1、域
* TLD：Top Level Domain(顶级域名)
* 组织域：.com, .org, .net, .edu,.gov,.mil,.cc等
* 国家域：.cn, .us, .tw, .iq等
* 反向域： .in-addr-arpa等

上面提到过，DNS采用分级的授权管理机制，其结构如下所示：

![image](https://github.com/chenhuyang/konwledge_point/blob/master/Dns_picture/Dns_structure.png)

根域与一级域由IANA直接管理。
### 2、FQDN
* FQDN全称为Fully Qualified Domain Name，即完全合格域名。
* FQDN由两个部分组成：主机名和域名。因为DNS是逐级管理的，
* 所以在不同的层级中主机名与域名也是不同的；以www.google.com为例，在第二层中，.com就是域名，google就是主机名，而到了第三层中，.google.com就成了域名,www就成了主机名。
* 注意：主机名与域名并不是依据"."来划分的，主机名中也可以包含"."号的，主要还是要根据域名的注册情况来划分。
### 3、正向解析
* 从FQDN转换为IP地址称为正向解析。
### 4、反向解析 
* 从IP地址转换为FQDN称为反向解析。   
### 5、区域
* 正向解析或反向解析中，每个域的记录就是一个区域。
## 三、DNS的解析库
### 1、DNS的主要作用是进行主机名的解析。
#### 1.1 解析：根据用户提供一种名称，去查询解析库，以得到另一种名称。 
#### 1.2 正向解析与反向解析使用不同的解析库。
##### 1.2.1 资源记录：rr(resource record)
##### 1.2.2 有类型的概念；用于此记录解析的属性。
* SOA：Start of Authority，起始授权记录，一个区域文件只能有一个。
* NS：Name Server，可以有多个。
* MX：Mail eXchange，邮件交换器。标明域内的邮件服务器，MX记录有优先级属性（0-99）；数字越小，优先级越高。
* A：FQDNàIP，专用于正向解析库。
* PTR：IPàFQDN，专用于反向解析库。
* AAAA：FQDNàIPv6，专用于正向解析库。
* CNAME：Canonical Name，正式名称。
#### 1.3 解析库文件同步的过程：区域传送（单方向传送）
##### 1.3.1 完全区域传送：axfr
* 将整个区域传送到各服务器。
##### 1.3.2 增量区域传送：ixfr
* 只将区域有改动的记录传送到各服务器。
## 四、DNS的查询过程
### 1、假设访问www.google.com,DNS解析过程如下： 
* 客户端向DNS服务器发起查询请求，DNS服务器搜索本地解析库没有结果，于是向根域发起查询请求，根域告诉DNS服务器.com服务器上有它需要的
资源，DNS服务器又向.com服务器发起查询请求，结果被告知.google.com服务器上有它想要的结果，最后终于在.google.com服务器
上找到了解析记录，并返回给了客户端。
### 2、DNS采用两种查询机制：递归和迭代。

![image](https://github.com/chenhuyang/konwledge_point/blob/master/Dns_picture/Dns_lookup.png)

* 在上面的查询过程中，客户端只发起了一次请求，并得到了最后的结果，这种查询方式被称为递归。
* 而DNS服务器在查询过程中不停的发起请求，直到找到想要的结果，这种查询方式被称为迭代。
### 3、注意
* 根不会为任何请求递归。
* DNS服务器并不需要在客户端每次发起请求时都执行迭代查询，DNS服务器会将之前的查询结果在本地存储一份，如果客户端再次请求此资源，可以马上做出响应，这个存储空间称为本地DNS缓存。
* 另外我们可能还经常会听到两个概念权威DNS服务器和非权威应答。
* 权威DNS服务器说的容易理解一点，就是如果本地DNS的配置文件中写明了FQDN与IP的对应关系的，并授权管理这个域时，那么就称这台DNS服务器是该域的权威DNS服务器。
* 客户端得到的DNS查询结果是从本地DNS缓存中获得的，那么称这个解析结果为非权威应答；非权威应答的结果不一定是正确的，有可能权威DNS服务器上记录已修改，而缓存中还是未更新的记录。
## 五、DNS的查询顺序
* 本地hosts文件
* 本地DNS缓存
* 本地DNS服务器
* 发起迭代查询
## 六、DNS使用的端口号
* DNS协议使用udp/tcp的53端口提供服务，客户端向DNS服务发起请求时，使用udp的53端口；DNS服务器间进行区域传送的时候使用TCP的53端口。
## 七、DNS服务器类型
### 1、主DNS服务器
* 为客户端提供域名解析的主要区域，主DNS服务器宕机，会启用从DNS服务器提供服务。
### 2、从DNS服务器
* 主服务器DNS长期无应答，从服务器也会停止提供服务。
* 主从区域之间的同步采用周期性检查+通知的机制，从服务器周期性的检查主服务器上的记录情况，一旦发现修改就会同步，另外主服务器上如果有数据被修改了，会立即通知从服务器更新记录。
### 3、缓存服务器
* 服务器本身不提供解析区域，只提供非权威应答。
### 4、转发服务器
* 当DNS服务器的解析区域（包括缓存）中无法为当前的请求提供权威应答时，将请求转发至其它的DNS服务器，此时本地DNS服务器就是转发服务器。
